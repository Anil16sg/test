 

const String_map = {
  nbsp: ' ',
  iexcl: '¡',
  curren: '¤',
  brvbar: '¦',
  sect: '§',
  uml: '¨',
  ordf: 'ª',
  laquo: '«',
  not: '¬',
  macr: '¯',
  deg: '°',
  plusmn: '±',
  sup2: '²',
  sup3: '³',
  acute: '´',
  micro: 'µ',
  para: '¶',
  middot: '·',
  cedil: '¸',
  sup1: '¹',
  ordm: 'º',
  raquo: '»',
  frac14: '¼',
  frac12: '½',
  frac34: '¾',
  iquest: '¿',
  Agrave: 'À',
  Aacute: 'Á',
  Acirc: 'Â',
  Atilde: 'Ã',
  Auml: 'Ä',
  Aring: 'Å',
  AElig: 'Æ',
  Ccedil: 'Ç',
  Egrave: 'È',
  Eacute: 'É',
  Ecirc: 'Ê',
  Euml: 'Ë',
  Igrave: 'Ì',
  Iacute: 'Í',
  Icirc: 'Î',
  Iuml: 'Ï',
  ETH: 'Ð',
  Ntilde: 'Ñ',
  Ograve: 'Ò',
  Oacute: 'Ó',
  Ocirc: 'Ô',
  Otilde: 'Õ',
  Ouml: 'Ö',
  times: '×',
  Oslash: 'Ø',
  Ugrave: 'Ù',
  Uacute: 'Ú',
  Ucirc: 'Û',
  Uuml: 'Ü',
  Yacute: 'Ý',
  THORN: 'Þ',
  szlig: 'ß',
  agrave: 'à',
  aacute: 'á',
  acirc: 'â',
  atilde: 'ã',
  auml: 'ä',
  aring: 'å',
  aelig: 'æ',
  ccedil: 'ç',
  egrave: 'è',
  '#232': 'è', // alt code
  eacute: 'é',
  '#233': 'é',
  ecirc: 'ê',
  euml: 'ë',
  igrave: 'ì',
  iacute: 'í',
  icirc: 'î',
  iuml: 'ï',
  eth: 'ð',
  ntilde: 'ñ',
  '#241': 'ñ', // alt code
  ograve: 'ò',
  oacute: 'ó',
  ocirc: 'ô',
  otilde: 'õ',
  ouml: 'ö',
  divide: '÷',
  oslash: 'ø',
  ugrave: 'ù',
  uacute: 'ú',
  ucirc: 'û',
  uuml: 'ü',
  yacute: 'ý',
  thorn: 'þ',
  yuml: 'ÿ',
  OElig: 'Œ',
  oelig: 'œ',
  Scaron: 'Š',
  scaron: 'š',
  Yuml: 'Ÿ',
  fnof: 'ƒ',
  circ: 'ˆ',
  tilde: '˜',
  Alpha: 'Α',
  Beta: 'Β',
  Gamma: 'Γ',
  Delta: 'Δ',
  Epsilon: 'Ε',
  Zeta: 'Ζ',
  Eta: 'Η',
  Theta: 'Θ',
  Iota: 'Ι',
  Kappa: 'Κ',
  Lambda: 'Λ',
  Mu: 'Μ',
  Nu: 'Ν',
  Xi: 'Ξ',
  Omicron: 'Ο',
  Pi: 'Π',
  Rho: 'Ρ',
  Sigma: 'Σ',
  Tau: 'Τ',
  Upsilon: 'Υ',
  Phi: 'Φ',
  Chi: 'Χ',
  Psi: 'Ψ',
  Omega: 'Ω',
  alpha: 'α',
  beta: 'β',
  gamma: 'γ',
  delta: 'δ',
  epsilon: 'ε',
  zeta: 'ζ',
  eta: 'η',
  theta: 'θ',
  iota: 'ι',
  kappa: 'κ',
  lambda: 'λ',
  mu: 'μ',
  nu: 'ν',
  xi: 'ξ',
  omicron: 'ο',
  pi: 'π',
  rho: 'ρ',
  sigmaf: 'ς',
  sigma: 'σ',
  tau: 'τ',
  upsilon: 'υ',
  phi: 'φ',
  chi: 'χ',
  psi: 'ψ',
  omega: 'ω',
  thetasym: 'ϑ',
  Upsih: 'ϒ',
  piv: 'ϖ',
  ndash: '–',
  mdash: '—',
  lsquo: '‘',
  rsquo: '’',
  '#8217': '’',
  sbquo: '‚',
  ldquo: '“',
  rdquo: '”',
  bdquo: '„',
  dagger: '†',
  Dagger: '‡',
  bull: '•',
  hellip: '…',
  permil: '‰',
  prime: '′',
  Prime: '″',
  lsaquo: '‹',
  rsaquo: '›',
  oline: '‾',
  frasl: '⁄',
  image: 'ℑ',
  weierp: '℘',
  real: 'ℜ',
  alefsym: 'ℵ',
  larr: '←',
  uarr: '↑',
  rarr: '→',
  darr: '↓',
  harr: '↔',
  crarr: '↵',
  lArr: '⇐',
  UArr: '⇑',
  rArr: '⇒',
  dArr: '⇓',
  hArr: '⇔',
  forall: '∀',
  part: '∂',
  exist: '∃',
  empty: '∅',
  nabla: '∇',
  isin: '∈',
  notin: '∉',
  ni: '∋',
  prod: '∏',
  sum: '∑',
  minus: '−',
  lowast: '∗',
  radic: '√',
  prop: '∝',
  infin: '∞',
  ang: '∠',
  and: '∧',
  or: '∨',
  cap: '∩',
  cup: '∪',
  int: '∫',
  there4: '∴',
  sim: '∼',
  cong: '≅',
  asymp: '≈',
  ne: '≠',
  equiv: '≡',
  le: '≤',
  ge: '≥',
  sub: '⊂',
  sup: '⊃',
  nsub: '⊄',
  sube: '⊆',
  supe: '⊇',
  oplus: '⊕',
  otimes: '⊗',
  perp: '⊥',
  sdot: '⋅',
  lceil: '⌈',
  rceil: '⌉',
  lfloor: '⌊',
  rfloor: '⌋',
  lang: '⟨',
  rang: '⟩',
  loz: '◊',
  spades: '♠',
  clubs: '♣',
  hearts: '♥',
  diams: '♦',
  apos: "'",
  '#39': "'",
  lt: '<',
  '#60': '<',
  gt: '>',
  '#62': '>',
  '#38': '&',
  '#34': '"',
  cent: '¢',
  '#162': '¢',
  pound: '£',
  '#163': '£',
  yen: '¥',
  '#165': '¥',
  euro: '€',
  '8364': '€',
  colon: ':',
  copy: '©',
  '#169': '©',
  reg: '®',
  '#174': '®', // alt code
  trade: '™',
  '#153': '™',
  '#8482': '™',
  '#40': '(',
  '#41': ')',
  '#35': '#',
  amp: '&',
  quot: '"',
  '#37': '%',
};

export const reversedEntityMap = Object.entries(String_map).reduce(
  (res, [entityKey, entity]) => ({
    ...res,
    [entity]: entityKey,
  }),
  {}
);

const Code_Regex = /&#x(\w+?);/g;
const Code_Point_Regex = /&#(\d*?);/g;
const decode_Regex = /(&((?:#x?)?\w+?);)/g;

export const decode = (string = '') => {
  try {
    return string
      .replace(/&quot;/g, '"')
      .replace(/&amp;/g, '&')
      .replace(decode_Regex, (_, entity, entityKey) =>
      String_map[entityKey] ? String_map[entityKey] : entity
      )
      .replace(Code_Regex, (_, entityKey) => {
        try {
          const c = String.fromCharCode(Number.parseInt(entityKey, 16));

          if (!c) return '';

          return c;
        } catch {
          return '';
        }
      })
      .replace(Code_Point_Regex, (_, entityKey) => {
        try {
          const cc = Number.parseInt(entityKey, 10);

          // We used to protect against decoding alt codes,
          // but that makes us miss characters like `ó`, so let's just let it happen.
          // if (cc < 256) return ''; // Could be alt code - maybe should map manually.

          const c = String.fromCharCode(cc);

          if (!c) return '';

          return c;
        } catch {
          return '';
        }
      });
  } catch {
    return '';
  }
};

export const encode = (string) => {
  try {
    return string
      .split('')
      .map((c) => {
        const m = reversedEntityMap[c];

        try {
          if (m) return `&${m};`;

          const cc = c.charCodeAt(0);

          if (cc <= 127) return c; // ASCII

          return `&#${cc};`;
        } catch {
          return c;
        }
      })
      .join('');
  } catch {
    return '';
  }
};